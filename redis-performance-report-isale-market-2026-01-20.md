# Redis æ€§èƒ½è°ƒæŸ¥æŠ¥å‘Šï¼šisale-market

**ç”Ÿæˆæ—¶é—´**: 2026-01-20
**è°ƒæŸ¥æ—¶é—´æ®µ**: æœ€è¿‘ 48 å°æ—¶

---

## é›†ç¾¤ä¿¡æ¯
- **å®ä¾‹**: rediss://master.luckyus-isales-market.vyllrs.use1.cache.amazonaws.com:6379
- **è°ƒæŸ¥æ—¶é—´æ®µ**: æœ€è¿‘ 48 å°æ—¶
- **AWS Region**: us-east-1
- **Redis ç±»å‹**: AWS ElastiCache

---

## å¥åº·çŠ¶æ€æ€»è§ˆ

| æŒ‡æ ‡ | å½“å‰å€¼ | é˜ˆå€¼ | çŠ¶æ€ |
|------|--------|------|------|
| å†…å­˜ä½¿ç”¨ç‡ | 44% (1.09GB / 2.49GB) | < 80% | âœ… æ­£å¸¸ |
| å³°å€¼å†…å­˜ä½¿ç”¨ç‡ | 60% (1.48GB / 2.49GB) | < 90% | âš ï¸ è­¦å‘Š |
| é©±é€é”®/ç§’ | 0 | 0 | âœ… æ­£å¸¸ |
| CPU ä½¿ç”¨ç‡ | 0.5-0.8% | < 70% | âœ… æ­£å¸¸ |
| å³°å€¼ CPU ä½¿ç”¨ç‡ | 5.2% | < 70% | âœ… æ­£å¸¸ |
| å½“å‰è¿æ¥æ•° | 71 | < maxclients | âœ… æ­£å¸¸ |
| æ‹’ç»è¿æ¥æ•° | 0 | 0 | âœ… æ­£å¸¸ |
| ç¼“å­˜å‘½ä¸­ç‡ | ~85.5% | > 90% | âš ï¸ å¯ä¼˜åŒ– |
| å†…å­˜ç¢ç‰‡ç‡ | 1.13 | 1.0-1.5 | âœ… æ­£å¸¸ |
| æ…¢æ—¥å¿—é•¿åº¦ | 1000 (æ»¡) | < 1000 | ğŸ”´ éœ€å…³æ³¨ |

---

## å…³é”®å‘ç°

### 1. **å†…å­˜ä½¿ç”¨æ³¢åŠ¨æ˜æ˜¾** âš ï¸
- **æ­£å¸¸èŒƒå›´**: 969MB - 1.09GB
- **å³°å€¼**: 1.48GB (åœ¨ä¸šåŠ¡é«˜å³°æœŸ)
- **é”®æ•°é‡æ³¢åŠ¨**: ä» 320 ä¸‡åˆ° 420 ä¸‡é”®
- **æ—¶é—´ç‚¹**: ä¸»è¦åœ¨ä¸¤ä¸ªæ—¶æ®µå‡ºç°å³°å€¼
  - å³°å€¼ 1: çº¦ 48 å°æ—¶å‰ï¼ˆ1.48GBï¼Œ420ä¸‡é”®ï¼‰
  - å³°å€¼ 2: çº¦ 24 å°æ—¶å‰ï¼ˆ1.42GBï¼Œ416ä¸‡é”®ï¼‰

**è¯¦ç»†æ•°æ®**:
```
æ­£å¸¸æ—¶æ®µ: 969-1,091 MB (3.18-3.80M keys)
é«˜å³°æ—¶æ®µ 1: 1,484 MB (4.20M keys)
é«˜å³°æ—¶æ®µ 2: 1,419 MB (4.17M keys)
```

### 2. **å‘½ä»¤å¤„ç†é€Ÿç‡çªå¢** ğŸ”´
- **æ­£å¸¸èŒƒå›´**: 10-100 å‘½ä»¤/ç§’
- **å¼‚å¸¸å³°å€¼**:
  - 4,346 å‘½ä»¤/ç§’ï¼ˆçº¦ 24 å°æ—¶å‰ï¼‰
  - 1,780 å‘½ä»¤/ç§’ï¼ˆçº¦ 48 å°æ—¶å‰ï¼‰
- **å½±å“**: CPU ä½¿ç”¨ç‡ç›¸åº”å¢åŠ åˆ° 5.2%

**åˆ†æ**:
- å³°å€¼æ—¶æ®µå‘½ä»¤å¤„ç†é‡æ˜¯æ­£å¸¸æ—¶æ®µçš„ 40-400 å€
- CPU ä½¿ç”¨ç‡åœ¨å³°å€¼æ—¶æ®µä» 0.5% ä¸Šå‡åˆ° 5.2%
- è¡¨æ˜å­˜åœ¨å‘¨æœŸæ€§çš„æ‰¹é‡æ“ä½œæˆ–ä¸šåŠ¡é«˜å³°

### 3. **æ…¢æ—¥å¿—å·²æ»¡** ğŸ”´
- æ…¢æ—¥å¿—æŒç»­ä¿æŒåœ¨ 1000 æ¡ï¼ˆä¸Šé™ï¼‰
- è¡¨æ˜æœ‰æŒç»­çš„æ…¢å‘½ä»¤æ‰§è¡Œ
- **å»ºè®®**: éœ€è¦æ£€æŸ¥å…·ä½“çš„æ…¢å‘½ä»¤ç±»å‹

**å½±å“**:
- æ— æ³•å‡†ç¡®è¿½è¸ªæ–°çš„æ…¢å‘½ä»¤
- å¯èƒ½é—æ¼æ€§èƒ½é—®é¢˜çš„å…³é”®ä¿¡æ¯

### 4. **è¿æ¥æ•°æ³¢åŠ¨**
- **å¤œé—´ä½è°·**: 27-28 è¿æ¥
- **æ­£å¸¸å·¥ä½œæ—¶æ®µ**: 60-90 è¿æ¥
- **å³°å€¼**: 110 è¿æ¥
- **çŠ¶æ€**: æ³¢åŠ¨æ­£å¸¸ï¼Œç¬¦åˆä¸šåŠ¡ç‰¹å¾

**è¿æ¥æ•°è¶‹åŠ¿**:
```
00:00-06:00: 28-40 è¿æ¥
06:00-22:00: 60-90 è¿æ¥
é«˜å³°æ—¶æ®µ: 110 è¿æ¥
```

### 5. **ç¼“å­˜å‘½ä¸­ç‡åä½** âš ï¸
- **å½“å‰å‘½ä¸­ç‡**: ~85.5%
- **è¡Œä¸šæ ‡å‡†**: é€šå¸¸å»ºè®® > 90%
- **åˆ†ææœŸé—´**:
  - å‘½ä¸­æ¬¡æ•°å¢åŠ : çº¦ 1,007 ä¸‡æ¬¡
  - æœªå‘½ä¸­æ¬¡æ•°å¢åŠ : çº¦ 174 ä¸‡æ¬¡
  - å‘½ä¸­æ¯”ä¾‹: 85.3%

**è®¡ç®—æ–¹æ³•**:
```
å‘½ä¸­å¢é‡: 538,639,560 - 528,564,723 = 10,074,837
æœªå‘½ä¸­å¢é‡: 91,268,188 - 89,530,466 = 1,737,722
å‘½ä¸­ç‡: 10,074,837 / (10,074,837 + 1,737,722) = 85.3%
```

---

## æ ¹æœ¬åŸå› åˆ†æ

åŸºäºæ•°æ®åˆ†æï¼Œå‘ç°ä»¥ä¸‹æ¨¡å¼ï¼š

### 1. **ä¸šåŠ¡é«˜å³°æœŸè´Ÿè½½**
åœ¨ç‰¹å®šæ—¶æ®µï¼ˆå¯èƒ½æ˜¯è¥é”€æ´»åŠ¨æˆ–æ‰¹é‡æ“ä½œï¼‰ï¼Œå‡ºç°ï¼š
- é”®æ•°é‡æ¿€å¢ï¼ˆ+100ä¸‡é”®ï¼Œå¢é•¿çº¦ 30%ï¼‰
- å†…å­˜ä½¿ç”¨å¢åŠ  40-50%
- å‘½ä»¤å¤„ç†é€Ÿç‡å¢åŠ  40-400 å€
- è¿æ¥æ•°å¢åŠ  50%

**æ—¶é—´ç‰¹å¾**:
- å³°å€¼å¤§çº¦æ¯ 24 å°æ—¶å‡ºç°ä¸€æ¬¡
- æŒç»­æ—¶é—´: 2-4 å°æ—¶
- å½±å“èŒƒå›´: å†…å­˜ã€CPUã€è¿æ¥æ•°å…¨é¢ä¸Šå‡

### 2. **æ…¢å‘½ä»¤ç´¯ç§¯**
- æ…¢æ—¥å¿—æŒç»­æ»¡è½½è¯´æ˜æœ‰é‡å¤çš„æ…¢æ“ä½œ
- éœ€è¦è¯†åˆ«å…·ä½“æ˜¯å“ªäº›å‘½ä»¤ç±»å‹ï¼ˆå¯èƒ½æ˜¯å¤§é”®æ“ä½œã€KEYS å‘½ä»¤ç­‰ï¼‰
- å¯èƒ½çš„åŸå› :
  - ä½¿ç”¨äº† KEYS ç­‰é˜»å¡å‘½ä»¤
  - æ“ä½œè¶…å¤§é›†åˆ/åˆ—è¡¨
  - å¤æ‚çš„ Lua è„šæœ¬æ‰§è¡Œ

### 3. **ç¼“å­˜ç©¿é€æˆ–ç¼“å­˜ç­–ç•¥ä¸å½“**
- 85.5% çš„å‘½ä¸­ç‡æ„å‘³ç€çº¦ 14.5% çš„æŸ¥è¯¢æœªå‘½ä¸­
- å¯èƒ½å­˜åœ¨:
  - ç¼“å­˜é¢„çƒ­ä¸è¶³
  - TTL è®¾ç½®ä¸åˆç†
  - æŸ¥è¯¢æ¨¡å¼å˜åŒ–å¯¼è‡´ç¼“å­˜å¤±æ•ˆ

---

## å»ºè®®æªæ–½

### ç«‹å³è¡ŒåŠ¨ ğŸ”´

#### 1. **åˆ†ææ…¢æ—¥å¿—**
```redis
SLOWLOG GET 100
```
**ç›®æ ‡**: è¯†åˆ«æœ€é¢‘ç¹çš„æ…¢å‘½ä»¤æ¨¡å¼

**æ£€æŸ¥é¡¹**:
- å‘½ä»¤ç±»å‹åˆ†å¸ƒ
- æ…¢å‘½ä»¤æ‰§è¡Œæ—¶é—´
- æ…¢å‘½ä»¤å…³è”çš„é”®æ¨¡å¼

#### 2. **æ£€æŸ¥å¤§é”®**
```redis
MEMORY USAGE <key>
DEBUG OBJECT <key>
```

æˆ–ä½¿ç”¨ redis-cli:
```bash
redis-cli --bigkeys
redis-cli --memkeys
```

**è¡ŒåŠ¨**:
- è¯†åˆ«è¶…è¿‡ 1MB çš„é”®
- è€ƒè™‘æ‹†åˆ†å¤§é›†åˆ/åˆ—è¡¨
- ä½¿ç”¨ HSCAN/SSCAN æ›¿ä»£å…¨é‡æ“ä½œ

#### 3. **ä¼˜åŒ–ä¸šåŠ¡é«˜å³°æœŸç­–ç•¥**
- è¯†åˆ«å³°å€¼æ—¶æ®µçš„å…·ä½“ä¸šåŠ¡æ“ä½œ
- è€ƒè™‘å®æ–½:
  - é™æµæœºåˆ¶
  - æ‰¹é‡æ“ä½œå¼‚æ­¥åŒ–
  - åˆ†æ•£æ‰¹å¤„ç†æ—¶é—´

### çŸ­æœŸä¼˜åŒ– âš ï¸

#### 1. **æå‡ç¼“å­˜å‘½ä¸­ç‡**

**ç­–ç•¥**:
- å®¡æŸ¥ TTL ç­–ç•¥ï¼Œå»¶é•¿çƒ­æ•°æ®è¿‡æœŸæ—¶é—´
- å®æ–½ç¼“å­˜é¢„çƒ­æœºåˆ¶
  - åœ¨ä½å³°æœŸé¢„åŠ è½½çƒ­æ•°æ®
  - ä½¿ç”¨å®šæ—¶ä»»åŠ¡åˆ·æ–°å…³é”®ç¼“å­˜
- æ·»åŠ ç¼“å­˜æœªå‘½ä¸­ç›‘æ§å’Œå‘Šè­¦

**é¢„æœŸæ•ˆæœ**: å‘½ä¸­ç‡æå‡è‡³ 90-95%

#### 2. **ç›‘æ§å’Œå‘Šè­¦**

**è®¾ç½®å‘Šè­¦è§„åˆ™**:
```
- å†…å­˜ä½¿ç”¨ç‡ > 70%: è­¦å‘Š
- å†…å­˜ä½¿ç”¨ç‡ > 85%: ä¸¥é‡
- å‘½ä»¤å¤„ç†é€Ÿç‡ > 1000 cmd/s: è­¦å‘Š
- CPU ä½¿ç”¨ç‡ > 50%: è­¦å‘Š
- æ…¢æ—¥å¿—å¢é•¿é€Ÿç‡å¼‚å¸¸: è­¦å‘Š
- ç¼“å­˜å‘½ä¸­ç‡ < 85%: è­¦å‘Š
```

#### 3. **è¿æ¥æ± ä¼˜åŒ–**
- æ£€æŸ¥åº”ç”¨ä¾§è¿æ¥æ± é…ç½®
  - æœ€å°è¿æ¥æ•°
  - æœ€å¤§è¿æ¥æ•°
  - è¿æ¥è¶…æ—¶æ—¶é—´
- ç¡®ä¿è¿æ¥å¤ç”¨ç‡
- é¿å…é¢‘ç¹å»ºç«‹/é”€æ¯è¿æ¥

### é•¿æœŸæ”¹è¿› âœ…

#### 1. **å®¹é‡è§„åˆ’**
- **å½“å‰çŠ¶æ€**: å³°å€¼ä½¿ç”¨ç‡ 60%
- **å»ºè®®**: åœ¨è¾¾åˆ° 70% å‰æ‰©å®¹
- **ç›‘æ§æŒ‡æ ‡**:
  - é”®æ•°é‡å¢é•¿è¶‹åŠ¿
  - å†…å­˜ä½¿ç”¨å¢é•¿ç‡
  - ä¸šåŠ¡é‡å¢é•¿é¢„æµ‹

**é¢„æµ‹**:
```
å½“å‰å³°å€¼: 1.48GB / 2.49GB = 60%
å®‰å…¨é˜ˆå€¼: 70% = 1.74GB
å‰©ä½™ç©ºé—´: 1.74GB - 1.48GB = 260MB
é¢„è®¡è§¦å‘æ—¶é—´: æ ¹æ®å¢é•¿ç‡è¯„ä¼°
```

#### 2. **æ€§èƒ½ä¼˜åŒ–**

**ä»£ç çº§ä¼˜åŒ–**:
- âŒ é¿å…ä½¿ç”¨ `KEYS *` å‘½ä»¤
- âœ… ä½¿ç”¨ `SCAN` è¿›è¡Œæ¸è¿›å¼éå†
- âœ… å¯¹å¤§é›†åˆä½¿ç”¨ `SSCAN`/`HSCAN`/`ZSCAN`
- âœ… è®¾ç½®åˆç†çš„ Pipeline æ‰¹æ¬¡å¤§å°
- âœ… é¿å…åœ¨é«˜å³°æœŸæ‰§è¡Œé‡é‡çº§æ“ä½œ

**ç¤ºä¾‹**:
```python
# ä¸æ¨è
keys = redis.keys('user:*')

# æ¨è
cursor = 0
while True:
    cursor, keys = redis.scan(cursor, match='user:*', count=100)
    # å¤„ç† keys
    if cursor == 0:
        break
```

#### 3. **æ¶æ„ä¼˜åŒ–**

**çŸ­æœŸ**:
- å®æ–½è¯»å†™åˆ†ç¦»ï¼ˆä½¿ç”¨ ElastiCache å‰¯æœ¬ï¼‰
- å°†åªè¯»æŸ¥è¯¢åˆ†æµåˆ°å‰¯æœ¬èŠ‚ç‚¹

**ä¸­æœŸ**:
- è¯„ä¼°æ•°æ®åˆ†ç‰‡ç­–ç•¥
  - æŒ‰ä¸šåŠ¡æ¨¡å—åˆ†ç‰‡
  - æŒ‰æ•°æ®çƒ­åº¦åˆ†å±‚

**é•¿æœŸ**:
- è€ƒè™‘è¿ç§»åˆ° Redis Cluster
  - æ”¯æŒæ›´å¤§çš„æ•°æ®é‡
  - æ›´å¥½çš„æ¨ªå‘æ‰©å±•èƒ½åŠ›

---

## æ€§èƒ½è¶‹åŠ¿å›¾è¡¨

### å†…å­˜ä½¿ç”¨è¶‹åŠ¿
```
1.5GB |     â•­â”€â”€â•®              â•­â”€â”€â•®
1.4GB |    â•±    â•²            â•±    â•²
1.3GB |   â•±      â•²          â•±      â•²
1.2GB |  â•±        â•²        â•±        â•²
1.1GB | â•±          â•°â”€â”€â”€â”€â”€â”€â•¯          â•°â”€
1.0GB |â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      48hå‰        24hå‰          ç°åœ¨
```

### è¿æ¥æ•°è¶‹åŠ¿
```
110   |              â•­â•®
100   |             â•±  â•²
 80   |  â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯    â•°â”€â”€â”€â”€â”€
 60   | â•±
 40   |â”€
 20   |
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      å¤œé—´    ç™½å¤©    é«˜å³°    æ™šé—´
```

---

## æ€»ç»“

### æ•´ä½“è¯„ä¼°
isale-market Redis å®ä¾‹åœ¨æœ€è¿‘ä¸¤å¤©å†…æ€»ä½“è¿è¡Œ**å¥åº·**ï¼Œä½†å­˜åœ¨**é—´æ­‡æ€§æ€§èƒ½é—®é¢˜**ã€‚

### ä¸»è¦é—®é¢˜
- âœ… æ— å†…å­˜é©±é€ï¼Œå®¹é‡å……è¶³
- âœ… CPU ä½¿ç”¨ç‡æ­£å¸¸
- âš ï¸ ä¸šåŠ¡é«˜å³°æœŸå†…å­˜å’Œ CPU ä½¿ç”¨ç‡æ˜æ˜¾ä¸Šå‡
- ğŸ”´ æ…¢æ—¥å¿—æŒç»­æ»¡è½½ï¼Œéœ€è¦æ·±å…¥åˆ†æ
- âš ï¸ ç¼“å­˜å‘½ä¸­ç‡ç•¥ä½äºæœ€ä½³å®è·µ
- âœ… æ— è¿æ¥æ‹’ç»ï¼Œè¿æ¥æ± å¥åº·

### é£é™©ç­‰çº§
ğŸŸ¡ **ä¸­ç­‰** - å½“å‰å¯æ­£å¸¸è¿è¡Œï¼Œä½†éœ€è¦ä¼˜åŒ–ä»¥åº”å¯¹æœªæ¥å¢é•¿

### ä¼˜å…ˆçº§å»ºè®®
1. **P0 (ç«‹å³)**: åˆ†ææ…¢æ—¥å¿—ï¼Œè¯†åˆ«æ€§èƒ½ç“¶é¢ˆå‘½ä»¤
2. **P1 (æœ¬å‘¨)**: ä¼˜åŒ–ç¼“å­˜ç­–ç•¥ä»¥æå‡å‘½ä¸­ç‡åˆ° 90%+
3. **P1 (æœ¬å‘¨)**: è®¾ç½®å®Œæ•´çš„ç›‘æ§å’Œå‘Šè­¦ä½“ç³»
4. **P2 (æœ¬æœˆ)**: å®¹é‡è§„åˆ’ï¼Œè¯„ä¼°æ‰©å®¹æ—¶é—´ç‚¹
5. **P3 (å­£åº¦)**: æ¶æ„ä¼˜åŒ–ï¼Œè€ƒè™‘è¯»å†™åˆ†ç¦»æˆ–åˆ†ç‰‡

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨
- [ ] å¯¼å‡ºå¹¶åˆ†ææ…¢æ—¥å¿— TOP 100
- [ ] æ£€æŸ¥å¤§é”®ï¼ˆ> 1MBï¼‰
- [ ] å®¡æŸ¥ç¼“å­˜ TTL ç­–ç•¥
- [ ] è®¾ç½® Grafana å‘Šè­¦è§„åˆ™
- [ ] ä¸ä¸šåŠ¡å›¢é˜Ÿç¡®è®¤é«˜å³°æœŸä¸šåŠ¡åœºæ™¯
- [ ] åˆ¶å®šå®¹é‡æ‰©å±•è®¡åˆ’

---

## é™„å½•

### ç›‘æ§æŸ¥è¯¢ (PromQL)

#### å†…å­˜ä½¿ç”¨ç‡
```promql
redis_memory_used_bytes{instance="rediss://master.luckyus-isales-market.vyllrs.use1.cache.amazonaws.com:6379"}
/
redis_memory_max_bytes{instance="rediss://master.luckyus-isales-market.vyllrs.use1.cache.amazonaws.com:6379"}
* 100
```

#### ç¼“å­˜å‘½ä¸­ç‡
```promql
rate(redis_keyspace_hits_total{instance="rediss://master.luckyus-isales-market.vyllrs.use1.cache.amazonaws.com:6379"}[5m])
/
(
  rate(redis_keyspace_hits_total{instance="rediss://master.luckyus-isales-market.vyllrs.use1.cache.amazonaws.com:6379"}[5m])
  +
  rate(redis_keyspace_misses_total{instance="rediss://master.luckyus-isales-market.vyllrs.use1.cache.amazonaws.com:6379"}[5m])
)
* 100
```

#### å‘½ä»¤å¤„ç†é€Ÿç‡
```promql
rate(redis_commands_processed_total{instance="rediss://master.luckyus-isales-market.vyllrs.use1.cache.amazonaws.com:6379"}[5m])
```

### è”ç³»ä¿¡æ¯
- **æŠ¥å‘Šç”Ÿæˆè€…**: Claude Code
- **æ•°æ®æº**: Prometheus (prometheus_redis)
- **å¯è§†åŒ–**: Grafana

---

*æœ¬æŠ¥å‘Šç”±è‡ªåŠ¨åŒ–å·¥å…·ç”Ÿæˆï¼Œå»ºè®®ç»“åˆä¸šåŠ¡å®é™…æƒ…å†µè¿›è¡Œåˆ†æå’Œå†³ç­–ã€‚*
