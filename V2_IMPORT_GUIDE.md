# Database Monitoring Dashboard V2 - å¯¼å…¥æŒ‡å—

## æœ€æ–°ç‰ˆæœ¬

**æŽ¨èä½¿ç”¨**: `database_monitoring_OPTIMIZED_V2.json`

åŸºäºŽæˆåŠŸçš„ FINAL_FIX æ¨¡æ¿åˆ›å»ºï¼Œå·²ä¿®å¤æ‰€æœ‰å·²çŸ¥å¯¼å…¥é—®é¢˜ã€‚

---

## å¯¼å…¥æ­¥éª¤

### 1. åˆ é™¤æ—§ç‰ˆæœ¬ï¼ˆå¦‚æžœå­˜åœ¨ï¼‰

å¦‚æžœä¹‹å‰å¯¼å…¥è¿‡å…¶ä»–ç‰ˆæœ¬çš„ Dashboardï¼š
```
è¿›å…¥æ—§ Dashboard â†’ Settings (å³ä¸Šè§’é½¿è½®) â†’ Delete dashboard
```

### 2. å¯¼å…¥ V2 ç‰ˆæœ¬

```
1. Grafana å·¦ä¾§èœå• â†’ + â†’ Import dashboard
2. Upload JSON file
3. é€‰æ‹©æ–‡ä»¶: database_monitoring_OPTIMIZED_V2.json
4. ç‚¹å‡» Import
```

### 3. é€‰æ‹©å®žä¾‹

- Dashboard é¡¶éƒ¨ä¼šæ˜¾ç¤º **Instance** ä¸‹æ‹‰æ¡†
- è¿™æ˜¯**å•é€‰æ¡†**ï¼ˆä¸æ”¯æŒå¤šé€‰ï¼Œæ—  "All" é€‰é¡¹ï¼‰
- é€‰æ‹©ä¸€ä¸ªå®žä¾‹æŸ¥çœ‹è¯¦ç»†æ•°æ®

---

## Dashboard ç»“æž„

### Panel 1: æ•°æ®åº“å¤§å°å˜åŒ–è¶‹åŠ¿
- **ç±»åž‹**: æ—¶é—´åºåˆ—å›¾
- **æ•°æ®èŒƒå›´**: æœ€è¿‘ 90 å¤©
- **è¿‡æ»¤**: âœ… å— Instance å˜é‡å½±å“
- **æ˜¾ç¤º**: æ‰€é€‰å®žä¾‹çš„å„ä¸ªæ•°æ®åº“å¤§å°å˜åŒ–æ›²çº¿
- **Legend**: æ˜¾ç¤ºæœ€æ–°å€¼ã€æœ€å¤§å€¼ã€æœ€å°å€¼

### Panel 2: å¢žé•¿æœ€å¿«çš„æ•°æ®åº“å®žä¾‹ (Top 10)
- **ç±»åž‹**: è¡¨æ ¼
- **æ•°æ®èŒƒå›´**: æœ€è¿‘ 30 å¤©
- **è¿‡æ»¤**: âŒ ä¸å— Instance å˜é‡å½±å“ï¼ˆæ˜¾ç¤ºå…¨å±€æ•°æ®ï¼‰
- **æ˜¾ç¤ºå­—æ®µ**:
  - `instance` - å®žä¾‹åç§°
  - `database_name` - æ•°æ®åº“åç§°
  - `current_size` - å½“å‰å¤§å°
  - `size_30_days_ago` - 30å¤©å‰å¤§å°
  - `growth_amount` - å¢žé•¿é‡
  - `growth_rate_percent` - å¢žé•¿çŽ‡ï¼ˆ%ï¼‰
- **æŽ’åº**: æŒ‰å¢žé•¿çŽ‡é™åº

### Panel 3: å‰©ä½™ç©ºé—´æœ€å°‘çš„å®žä¾‹ (Top 10)
- **ç±»åž‹**: è¡¨æ ¼
- **æ•°æ®æ¥æº**: RDS å®žä¾‹å­˜å‚¨ä¿¡æ¯
- **è¿‡æ»¤**: âŒ ä¸å— Instance å˜é‡å½±å“ï¼ˆæ˜¾ç¤ºå…¨å±€æ•°æ®ï¼‰
- **æ˜¾ç¤ºå­—æ®µ**:
  - `instance` - å®žä¾‹åç§°
  - `database_name` - æ•°æ®åº“åç§°
  - `allocated_storage` - å·²åˆ†é…å­˜å‚¨ (GB)
  - `max_allocated_storage` - æœ€å¤§å­˜å‚¨é™åˆ¶ (GB)
  - `remaining_storage_gb` - å‰©ä½™ç©ºé—´ (GB)
  - `remaining_percent` - å‰©ä½™ç™¾åˆ†æ¯”
- **é¢œè‰²æ ‡è¯†**:
  - ðŸŸ¢ ç»¿è‰²: > 50% å‰©ä½™
  - ðŸŸ¡ é»„è‰²: 20% - 50% å‰©ä½™
  - ðŸ”´ çº¢è‰²: < 20% å‰©ä½™ï¼ˆéœ€è¦å…³æ³¨ï¼ï¼‰
- **æŽ’åº**: æŒ‰å‰©ä½™ç©ºé—´å‡åºï¼ˆæœ€å°‘çš„åœ¨å‰ï¼‰

### Panel 4: æ•°æ®åº“å¤§å°è¯¦ç»†æ•°æ®
- **ç±»åž‹**: è¡¨æ ¼
- **æ•°æ®èŒƒå›´**: æœ€è¿‘ 500 æ¡è®°å½•
- **è¿‡æ»¤**: âœ… å— Instance å˜é‡å½±å“
- **æ˜¾ç¤ºå­—æ®µ**:
  - `database_name` - æ•°æ®åº“åç§°
  - `data_date` - æ•°æ®æ—¥æœŸ
  - `data_length` - æ•°æ®åº“å¤§å°
- **æ³¨æ„**: ä¸æ˜¾ç¤º instance åˆ—ï¼ˆå› ä¸ºå·²é€šè¿‡å˜é‡é€‰æ‹©ï¼‰

---

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: ç›‘æŽ§ç‰¹å®šå®žä¾‹çš„å¢žé•¿è¶‹åŠ¿
1. ä»Ž Instance ä¸‹æ‹‰æ¡†é€‰æ‹©å®žä¾‹ï¼ˆä¾‹å¦‚ï¼š`aws-luckyus-icyberdata-rw`ï¼‰
2. æŸ¥çœ‹ **Panel 1** æŸ¥çœ‹ 90 å¤©è¶‹åŠ¿
3. æŸ¥çœ‹ **Panel 4** æŸ¥çœ‹æœ€è¿‘ 500 æ¡è¯¦ç»†è®°å½•

### åœºæ™¯ 2: è¯†åˆ«éœ€è¦æ‰©å®¹çš„æ•°æ®åº“
1. æŸ¥çœ‹ **Panel 2** - æ‰¾å‡ºå¢žé•¿æœ€å¿«çš„æ•°æ®åº“
2. æŸ¥çœ‹ **Panel 3** - æ‰¾å‡ºå‰©ä½™ç©ºé—´æœ€å°‘çš„å®žä¾‹
3. å…³æ³¨çº¢è‰²æ ‡è®°ï¼ˆå‰©ä½™ < 20%ï¼‰çš„å®žä¾‹
4. é€‰æ‹©å¯¹åº”å®žä¾‹ï¼Œåœ¨ Panel 1 æŸ¥çœ‹è¯¦ç»†è¶‹åŠ¿

### åœºæ™¯ 3: å®¹é‡è§„åˆ’
1. ä»Ž Panel 2 äº†è§£å¢žé•¿é€ŸçŽ‡
2. ä»Ž Panel 3 äº†è§£å½“å‰å‰©ä½™ç©ºé—´
3. è®¡ç®—é¢„è®¡æ‰©å®¹æ—¶é—´ï¼š`å‰©ä½™ç©ºé—´ Ã· 30å¤©å¢žé•¿é‡ â‰ˆ å‰©ä½™å¤©æ•°`

---

## æŠ€æœ¯ç»†èŠ‚

### Instance å˜é‡é…ç½®
```json
{
  "name": "instance",
  "type": "query",
  "multi": false,           // å•é€‰
  "includeAll": false,      // æ—  "All" é€‰é¡¹
  "query": "SELECT DISTINCT instance FROM luckyus_db_collection.t_dba_collect_database_info ORDER BY instance"
}
```

### å¢žé•¿çŽ‡è®¡ç®—å…¬å¼
```
å¢žé•¿é‡ = å½“å‰å¤§å° - 30å¤©å‰å¤§å°
å¢žé•¿çŽ‡ = (å¢žé•¿é‡ / 30å¤©å‰å¤§å°) Ã— 100%
```

### å‰©ä½™ç©ºé—´è®¡ç®—å…¬å¼
```
å‰©ä½™ç©ºé—´ = max_allocated_storage - allocated_storage
å‰©ä½™ç™¾åˆ†æ¯” = (å‰©ä½™ç©ºé—´ / max_allocated_storage) Ã— 100%
```

### æ•°æ®è¡¨ä¾èµ–
- `luckyus_db_collection.t_dba_collect_database_info` - æ•°æ®åº“å¤§å°åŽ†å²æ•°æ®
- `luckyus_db_collection.t_dba_collect_rds_instances` - RDS å®žä¾‹å­˜å‚¨å®¹é‡ä¿¡æ¯

---

## å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆ Panel 2 å’Œ Panel 3 ä¸å— Instance å˜é‡å½±å“ï¼Ÿ
A: è¿™ä¸¤ä¸ªé¢æ¿éœ€è¦æ˜¾ç¤º**å…¨å±€æ•°æ®**ï¼Œå¸®åŠ©è¯†åˆ«ï¼š
- å“ªäº›å®žä¾‹å¢žé•¿æœ€å¿«ï¼ˆå¯èƒ½éœ€è¦å…³æ³¨ï¼‰
- å“ªäº›å®žä¾‹ç©ºé—´ä¸è¶³ï¼ˆå¯èƒ½éœ€è¦æ‰©å®¹ï¼‰

å¦‚æžœè¿™äº›æ•°æ®ä¹Ÿè¢«è¿‡æ»¤ï¼Œå°±æ— æ³•çœ‹åˆ°å…¨å±€æƒ…å†µã€‚

### Q: å¦‚æžœå¢žé•¿çŽ‡ä¸ºè´Ÿæ•°æ€Žä¹ˆåŠžï¼Ÿ
A: è´Ÿæ•°è¡¨ç¤ºæ•°æ®åº“å¤§å°åœ¨å‡å°‘ï¼Œå¯èƒ½åŽŸå› ï¼š
- æ•°æ®æ¸…ç†/å½’æ¡£
- è¡¨è¢«åˆ é™¤
- æ•°æ®è¿ç§»

è¿™æ˜¯æ­£å¸¸æƒ…å†µï¼ŒæŒ‰é™åºæŽ’åºæ—¶è´Ÿå¢žé•¿ä¼šæŽ’åœ¨æœ€åŽã€‚

### Q: Panel 3 æŸäº›å®žä¾‹çš„ database_name ä¸ºç©ºï¼Ÿ
A: å¯èƒ½åŽŸå› ï¼š
- RDS å®žä¾‹å­˜åœ¨ï¼Œä½†æ•°æ®é‡‡é›†è¡¨ä¸­æ²¡æœ‰å¯¹åº”çš„æ•°æ®åº“è®°å½•
- ä½¿ç”¨äº† LEFT JOINï¼Œå…è®¸ database_name ä¸º NULL
- å»ºè®®æ£€æŸ¥æ•°æ®é‡‡é›†ç¨‹åºæ˜¯å¦æ­£å¸¸è¿è¡Œ

### Q: å¯¼å…¥åŽä»ç„¶æ˜¯ç©ºç™½ï¼Ÿ
A: è¯·æ£€æŸ¥ï¼š
1. ä½¿ç”¨çš„æ˜¯ `database_monitoring_OPTIMIZED_V2.json` æ–‡ä»¶
2. MySQL æ•°æ®æº UID æ˜¯å¦æ­£ç¡®ï¼ˆå½“å‰é…ç½®ï¼šLJ7ObqYNkï¼‰
3. æ•°æ®åº“è¡¨æ˜¯å¦æœ‰æ•°æ®ï¼ˆå°¤å…¶æ˜¯æœ€è¿‘ 90 å¤©çš„æ•°æ®ï¼‰
4. Grafana ç‰ˆæœ¬å…¼å®¹æ€§ï¼ˆæŽ¨è 9.4+ï¼‰

---

## ç‰ˆæœ¬åŽ†å²

- **V2** (2026-01-16) - å½“å‰ç‰ˆæœ¬
  - åŸºäºŽ FINAL_FIX æ¨¡æ¿
  - å•é€‰å®žä¾‹å˜é‡
  - 4 ä¸ªä¼˜åŒ–é¢æ¿
  - å¢žé•¿åˆ†æžå’Œå‰©ä½™ç©ºé—´ç›‘æŽ§

- **FINAL_FIX** (2026-01-15)
  - æˆåŠŸå¯¼å…¥çš„åŸºç¡€ç‰ˆæœ¬
  - å¤šé€‰å˜é‡é…ç½®
  - 5 ä¸ªåŸºç¡€é¢æ¿

---

## åŽç»­ä¼˜åŒ–å»ºè®®

1. **å‘Šè­¦é…ç½®**
   - å‰©ä½™ç©ºé—´ < 20% æ—¶å‘é€å‘Šè­¦
   - å¢žé•¿çŽ‡è¶…è¿‡é˜ˆå€¼æ—¶å‘é€å‘Šè­¦

2. **è¶‹åŠ¿é¢„æµ‹**
   - åŸºäºŽ 30 å¤©å¢žé•¿çŽ‡é¢„æµ‹æ‰©å®¹æ—¶é—´
   - æ·»åŠ é¢„æµ‹æ›²çº¿åˆ°è¶‹åŠ¿å›¾

3. **è‡ªåŠ¨åŒ–å“åº”**
   - é›†æˆ Grafana Alerting
   - è§¦å‘è‡ªåŠ¨æ‰©å®¹å·¥ä½œæµ

4. **åŽ†å²å¯¹æ¯”**
   - æœˆåº¦/å­£åº¦å¢žé•¿å¯¹æ¯”
   - åŒæ¯”/çŽ¯æ¯”æ•°æ®åˆ†æž
